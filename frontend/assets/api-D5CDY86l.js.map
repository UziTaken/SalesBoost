{"version":3,"file":"api-D5CDY86l.js","sources":["../../src/lib/api.ts"],"sourcesContent":["import axios, { AxiosError } from 'axios';\nimport { supabase } from './supabase';\nimport { env } from '@/config/env';\n\n/**\n * Axios instance configured with base URL and interceptors\n * Uses validated environment variables\n */\nexport const api = axios.create({\n  baseURL: env.VITE_API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  timeout: 30000, // 30 second timeout\n});\n\n/**\n * Request interceptor: Add authentication token to all requests\n */\napi.interceptors.request.use(\n  async (config) => {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (session?.access_token) {\n      config.headers.Authorization = `Bearer ${session.access_token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Response interceptor: Handle errors globally\n */\napi.interceptors.response.use(\n  (response) => response,\n  async (error: AxiosError) => {\n    // Handle 401 Unauthorized - redirect to login\n    if (error.response?.status === 401) {\n      console.error('Unauthorized access - redirecting to login');\n\n      // Sign out user\n      await supabase.auth.signOut();\n\n      // Redirect to login page\n      if (window.location.pathname !== '/login') {\n        window.location.href = '/login';\n      }\n    }\n\n    // Handle network errors\n    if (!error.response) {\n      console.error('Network error - please check your connection');\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport default api;\n"],"names":["api","axios","create","baseURL","env","VITE_API_URL","headers","timeout","interceptors","request","use","config","data","session","supabase","auth","getSession","access_token","Authorization","error","Promise","reject","response","status","console","signOut","window","location","pathname","href"],"mappings":"kFAQO,MAAMA,EAAMC,EAAMC,OAAO,CAC9BC,QAASC,EAAIC,aACbC,QAAS,CACP,eAAgB,kBAAA,EAElBC,QAAS,GACX,CAAC,EAKDP,EAAIQ,aAAaC,QAAQC,IACvB,MAAOC,GAAW,CAChB,KAAM,CAAEC,KAAM,CAAEC,QAAAA,CAAAA,CAAQ,EAAM,MAAMC,EAASC,KAAKC,WAAAA,EAClD,OAAIH,GAAAA,MAAAA,EAASI,eACXN,EAAOL,QAAQY,cAAgB,UAAUL,EAAQI,YAAY,IAExDN,CACT,EACCQ,GACQC,QAAQC,OAAOF,CAAK,CAE/B,EAKAnB,EAAIQ,aAAac,SAASZ,IACvBY,GAAaA,EACd,MAAOH,GAAsB,OAE3B,QAAIA,EAAAA,EAAMG,WAANH,YAAAA,EAAgBI,UAAW,MAC7BC,QAAQL,MAAM,4CAA4C,EAG1D,MAAML,EAASC,KAAKU,QAAAA,EAGhBC,OAAOC,SAASC,WAAa,WAC/BF,OAAOC,SAASE,KAAO,WAKtBV,EAAMG,UACTE,QAAQL,MAAM,8CAA8C,EAGvDC,QAAQC,OAAOF,CAAK,CAC7B,CACF"}